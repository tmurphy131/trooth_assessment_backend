<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>T[root]H Mentor Report</title>
  <style>
    body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#f7f7f9; margin:0; padding:24px; }
    .card { max-width:720px; margin:0 auto; background:#fff; border-radius:16px; padding:24px; box-shadow: 0 8px 24px rgba(0,0,0,.08);}
    .muted { color:#6b7280; }
    .h1 { font-size:22px; margin:0 0 8px; }
    .h2 { font-size:16px; margin:24px 0 8px; }
    .pill { display:inline-block; padding:4px 10px; border-radius:999px; background:#eef2ff; color:#3730a3; font-weight:600; font-size:12px; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .bar { height:10px; border-radius:8px; background:#eef2f7; overflow:hidden; }
    .bar > div { height:100%; background:#111827; }
    .kpi { display:flex; align-items:center; gap:12px; padding:12px; border:1px solid #e5e7eb; border-radius:12px; }
    .kpi .num { font-size:22px; font-weight:800; }
    .divider { height:1px; background:#e5e7eb; margin:24px 0; }
    .list { margin:8px 0; padding-left:16px; }
    .list li { margin:6px 0; }
    .foot { font-size:12px; color:#9ca3af; margin-top:24px; }
    .badge { font-weight:700; padding:2px 8px; border-radius:8px; background:#ecfeff; color:#155e75; }
    .insight-card { background:#f9fafb; border-radius:12px; padding:16px; margin:12px 0; }
    .insight-title { font-weight:600; color:#1f2937; }
    .insight-level { font-size:12px; color:#059669; font-weight:500; }
    .priority-card { background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius:12px; padding:16px; margin:16px 0; }
    .flag-red { color:#dc2626; }
    .flag-yellow { color:#d97706; }
    .flag-green { color:#059669; }
  </style>
</head>
<body>
  <div class="card">
    <div class="pill">T[root]H Mentor Report</div>
    <h1 class="h1">Apprentice: {{ apprentice_name }}</h1>
    <div class="muted">Submitted: {{ submitted_date }} ¬∑ Template: {{ template_version }}</div>

    <div class="grid" style="margin-top:16px;">
      <div class="kpi">
        <div class="num">{{ overall_mc_percent|int }}%</div>
        <div>
          <div class="muted">Biblical Knowledge</div>
          <div class="badge">{{ knowledge_band }}</div>
        </div>
      </div>
      <div class="kpi">
        <div class="num">{{ overall_score }}</div>
        <div>
          <div class="muted">Overall Score</div>
          <div class="badge">{{ overall_open_level }}</div>
        </div>
      </div>
    </div>

    {% if priority_action %}
    <div class="priority-card">
      <div style="font-weight:700; margin-bottom:8px;">üéØ Priority Action: {{ priority_action.title }}</div>
      <div style="margin-bottom:8px;">{{ priority_action.description }}</div>
      {% if priority_action.scripture %}
      <div class="muted">üìñ {{ priority_action.scripture }}</div>
      {% endif %}
    </div>
    {% endif %}

    {% if categories %}
    <div class="h2">Category Scores</div>
    {% for cat in categories %}
    <div style="margin:10px 0;">
      <div style="display:flex; justify-content:space-between; font-weight:600;">
        <span>{{ cat.name }}</span><span>{{ cat.score }}/10</span>
      </div>
      <div class="bar"><div style="width: {{ cat.score_percent }}%;"></div></div>
      <div class="muted" style="margin-top:6px;">Level: {{ cat.level }}</div>
    </div>
    {% endfor %}
    {% endif %}

    <div class="divider"></div>

    <div class="grid">
      <div>
        <div class="h2">‚ú® Top Strengths</div>
        <ul class="list">
          {% for s in top_strengths %}<li>{{ s }}</li>{% endfor %}
          {% if not top_strengths %}<li class="muted">No strengths identified yet</li>{% endif %}
        </ul>
      </div>
      <div>
        <div class="h2">üìà Growth Areas</div>
        <ul class="list">
          {% for g in top_gaps %}<li>{{ g }}</li>{% endfor %}
          {% if not top_gaps %}<li class="muted">No gaps identified</li>{% endif %}
        </ul>
      </div>
    </div>

    <div class="divider"></div>

    {% if open_insights %}
    <div class="h2">üí° Spiritual Insights</div>
    {% for insight in open_insights %}
    <div class="insight-card">
      <div class="insight-title">{{ insight.category or insight.title }}</div>
      <div class="insight-level">Level: {{ insight.level }}</div>
      {% if insight.evidence or insight.observation %}
      <div style="margin-top:8px; color:#4b5563;">{{ insight.evidence or insight.observation }}</div>
      {% endif %}
      {% if insight.mentor_moves %}
      <div style="margin-top:8px; font-weight:500; color:#1f2937;">Next Steps:</div>
      <ul class="list">
        {% for move in insight.mentor_moves %}<li>{{ move }}</li>{% endfor %}
      </ul>
      {% elif insight.next_step %}
      <div style="margin-top:8px;"><strong>Next Step:</strong> {{ insight.next_step }}</div>
      {% endif %}
    </div>
    {% endfor %}
    {% endif %}

    {% if flags %}
    <div class="divider"></div>
    <div class="h2">üö¶ Flags</div>
    {% if flags.red %}
    <div class="flag-red" style="margin:8px 0;">
      <strong>‚ö†Ô∏è Urgent Concerns:</strong>
      <ul class="list">{% for f in flags.red %}<li>{{ f }}</li>{% endfor %}</ul>
    </div>
    {% endif %}
    {% if flags.yellow %}
    <div class="flag-yellow" style="margin:8px 0;">
      <strong>‚ö° Watch Items:</strong>
      <ul class="list">{% for f in flags.yellow %}<li>{{ f }}</li>{% endfor %}</ul>
    </div>
    {% endif %}
    {% if flags.green %}
    <div class="flag-green" style="margin:8px 0;">
      <strong>‚úÖ Encouragements:</strong>
      <ul class="list">{% for f in flags.green %}<li>{{ f }}</li>{% endfor %}</ul>
    </div>
    {% endif %}
    {% endif %}

    {% if starters %}
    <div class="divider"></div>
    <div class="h2">üí¨ Conversation Starters</div>
    <ul class="list">{% for s in starters %}<li>{{ s }}</li>{% endfor %}</ul>
    {% endif %}

    {% if resources %}
    <div class="divider"></div>
    <div class="h2">üìö Recommended Resources</div>
    <ul class="list">
      {% for r in resources %}<li><strong>{{ r.title }}</strong> ‚Äî {{ r.why }} <span class="muted">({{ r.type }})</span></li>{% endfor %}
    </ul>
    {% endif %}

    {% if trend_note %}
    <div class="divider"></div>
    <div style="text-align:center; padding:16px; background:#f0fdf4; border-radius:12px;">
      <div style="font-weight:600;">{{ trend_note }}</div>
    </div>
    {% endif %}

    <div class="divider"></div>
    <div style="text-align:center;">
      <a href="{{ app_url }}" style="display:inline-block; padding:12px 24px; background:#1f2937; color:#fff; text-decoration:none; border-radius:8px; font-weight:600;">View Full Report in App</a>
    </div>

    <div class="foot">¬© {{ 'now'|strftime('%Y') }} T[root]H Assessment ¬∑ <a href="{{ app_url }}">{{ app_url }}</a></div>
  </div>
</body>
</html>
