<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Master T[root]H Discipleship Report</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif; background:#0a0a0a; margin:0; padding:24px; color:#e0e0e0; }
    .container { max-width: 720px; margin: 0 auto; background:#1a1a1a; border-radius:12px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); overflow:hidden; border:1px solid #333; }
    .header { background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%); color:#d4af37; padding:24px; display:flex; align-items:center; border-bottom:2px solid #d4af37; }
    .brand { font-weight:700; font-size:22px; letter-spacing:0.5px; color:#d4af37; }
    .pill { background: rgba(212,175,55,0.15); border:1px solid #d4af37; border-radius:24px; padding:6px 14px; font-size:12px; margin-left:auto; color:#d4af37; font-weight:600; }
    h1 { margin:0 0 8px 0; font-size:22px; color:#d4af37; }
    .section { padding:24px; border-top:1px solid #333; }
    .meta { color:#888; font-size:14px; }
    .score { font-size:48px; font-weight:800; color:#d4af37; }
    .chip { display:inline-block; background:#2a2a2a; border:1px solid #d4af37; color:#d4af37; border-radius:999px; padding:6px 12px; font-size:12px; margin:4px 6px 0 0; font-weight:600; }
    table { width:100%; border-collapse: collapse; margin-top:12px; }
    th, td { text-align:left; padding:12px; }
    th { background:#d4af37; color:#0a0a0a; font-weight:600; font-size:13px; }
    tr:nth-child(even) td { background:#222; }
    tr td { border-bottom:1px solid #333; }
    .cta { margin-top:20px; }
    .btn { display:inline-block; background: linear-gradient(135deg, #d4af37 0%, #e8c547 100%); color:#0a0a0a !important; text-decoration:none; padding:12px 24px; font-weight:700; border-radius:8px; }
    .footer { padding:18px 24px; color:#666; font-size:12px; text-align:center; border-top:1px solid #333; }
    .footer a { color:#d4af37; }
    .alert-red { background:rgba(220,38,38,0.15); border-left:4px solid #dc2626; padding:12px 16px; margin:12px 0; border-radius:6px; color:#fca5a5; }
    .alert-red strong { color:#f87171; }
    .alert-yellow { background:rgba(212,175,55,0.15); border-left:4px solid #d4af37; padding:12px 16px; margin:12px 0; border-radius:6px; color:#e8c547; }
    .alert-yellow strong { color:#d4af37; }
    .alert-green { background:rgba(16,185,129,0.15); border-left:4px solid #10b981; padding:12px 16px; margin:12px 0; border-radius:6px; color:#6ee7b7; }
    .alert-green strong { color:#34d399; }
    .priority-action { background:#2a2a2a; border:2px solid #d4af37; border-radius:8px; padding:16px; margin:16px 0; }
    .priority-action h3 { margin:0 0 8px 0; color:#d4af37; font-size:16px; }
    .action-card { display:flex; align-items:start; gap:12px; }
    .action-icon { font-size:32px; line-height:1; }
    .action-card strong { display:block; color:#d4af37; margin-bottom:4px; }
    .action-card p { margin:4px 0; color:#ccc; font-size:14px; line-height:1.5; }
    .action-card small { color:#888; font-size:12px; }
    .trend { background:rgba(212,175,55,0.1); border-left:3px solid #d4af37; padding:10px 14px; margin:12px 0; border-radius:4px; }
    .trend strong { color:#d4af37; }
    .knowledge-band { display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:600; margin-left:8px; }
    .band-excellent { background:rgba(16,185,129,0.2); color:#6ee7b7; border:1px solid #10b981; }
    .band-good { background:rgba(212,175,55,0.2); color:#e8c547; border:1px solid #d4af37; }
    .band-average { background:rgba(245,158,11,0.2); color:#fcd34d; border:1px solid #f59e0b; }
    .band-needs-improvement { background:rgba(249,115,22,0.2); color:#fdba74; border:1px solid #f97316; }
    .band-significant-study { background:rgba(220,38,38,0.2); color:#fca5a5; border:1px solid #dc2626; }
    .hashtags { color:#666; font-size:11px; margin-top:8px; }
    .hashtags span { color:#d4af37; }
  </style>
  <base target="_blank">
  <meta name="color-scheme" content="dark only">
  <meta name="supported-color-schemes" content="dark">
  <meta name="format-detection" content="telephone=no, date=no, address=no, email=no">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">T[root]H</div>
      <div class="pill">Master Assessment</div>
    </div>
    <div class="section">
      <h1>Master Assessment Report</h1>
      <div class="meta">{{ apprentice_name or 'Apprentice' }} ‚Ä¢ Completed ‚Ä¢ v{{ version }}</div>
    </div>
    
    {% if mentor_blob_v2 and mentor_blob_v2.flags %}
    <div class="section">
      {% if mentor_blob_v2.flags.red %}
        {% for flag in mentor_blob_v2.flags.red %}
        <div class="alert-red">
          <strong>‚ö†Ô∏è Urgent Attention Needed:</strong> {{ flag }}
        </div>
        {% endfor %}
      {% endif %}
      {% if mentor_blob_v2.flags.yellow %}
        {% for flag in mentor_blob_v2.flags.yellow[:1] %}
        <div class="alert-yellow">
          <strong>‚ö° Watch Item:</strong> {{ flag }}
        </div>
        {% endfor %}
      {% endif %}
      {% if mentor_blob_v2.flags.green %}
        {% for flag in mentor_blob_v2.flags.green[:1] %}
        <div class="alert-green">
          <strong>‚úÖ Encouragement:</strong> {{ flag }}
        </div>
        {% endfor %}
      {% endif %}
    </div>
    {% endif %}
    
    <div class="section">
      <div style="display:flex; align-items:center; gap:24px; flex-wrap:wrap;">
        <div>
          <div style="font-size:14px; color:#888;">Overall Score</div>
          <div class="score">{{ overall_score }}
            {% if mentor_blob_v2 and mentor_blob_v2.snapshot and mentor_blob_v2.snapshot.knowledge_band %}
              {% set band = mentor_blob_v2.snapshot.knowledge_band %}
              <span class="knowledge-band band-{{ band.lower().replace(' ', '-') }}">{{ band }}</span>
            {% endif %}
          </div>
        </div>
        <div style="flex:1; min-width:220px;">
          <div style="font-size:14px; color:#888; margin-bottom:6px;">Top Categories</div>
          <div>
            {% for c in top3 %}
              <span class="chip">{{ c.category }} ‚Ä¢ {{ c.score }}</span>
            {% else %}
              <span class="meta">No category breakdown available.</span>
            {% endfor %}
          </div>
        </div>
      </div>
      {% if summary_recommendation %}
      <div style="margin-top:12px; color:#374151;">{{ summary_recommendation }}</div>
      {% endif %}
      
      {% if trend_note %}
      <div class="trend">
        <strong>üìà Growth Trend:</strong> {{ trend_note }}
      </div>
      {% endif %}
    </div>
    
    {% if priority_action %}
    <div class="section priority-action">
      <h3>üéØ Priority Action This Week</h3>
      <div class="action-card">
        <div>
          <strong>{{ priority_action.title }}</strong>
          <p>{{ priority_action.description or priority_action.steps[0] if priority_action.steps else '' }}</p>
          {% if priority_action.scripture %}
          <small>üìñ {{ priority_action.scripture }}</small>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}
    
    <div class="section">
      <div style="font-size:14px; color:#6b7280;">Category Scores</div>
      <table>
        <thead><tr><th>Category</th><th>Score</th></tr></thead>
        <tbody>
          {% for name, score in category_scores.items() %}
          <tr><td style="color:#e0e0e0;">{{ name }}</td><td style="color:#d4af37; font-weight:600;">{{ score }}</td></tr>
          {% else %}
          <tr><td colspan="2" class="meta">No categories scored.</td></tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="cta"><a class="btn" href="{{ app_url or '#' }}">Open in App</a></div>
    </div>
    <div class="footer">
      <div style="color:#d4af37; font-weight:600; margin-bottom:4px;">T[root]H Discipleship</div>
      <div>View full report in the app</div>
      <div class="hashtags"><span>#getrooted</span> ‚Ä¢ <span>#LUKE850</span></div>
    </div>
  </div>
</body>
</html>
